{
	"name": "DEMO: Button-Only",
	"description": "Minimal functionality demo: Protected file is 'PAYLOAD.TXT' (upper case), grant (read-only) access for 5 minutes upon button-click",
	"parameters":
	{
		"payload_filename":     "${PECKUS_PAYLOAD_FILENAME=/PAYLOAD.TXT}",
		"payload_timeout_secs": "${PECKUS_RELOCK_TIMEOUT_SECS=300}"
	},
	"workflows":
	[
		{
			"name":"DEPLOY",
			"initial-state":"DEPLOY:START",
			"states":
			[
				{
					"name":        "DEPLOY:START",
					"actions":     [],
					"transitions": [{"state":"DEPLOY:WAIT.1", "conditions":["peckus:payload=UNINITIALIZED", "filesystem:mounted=TRUE", "filesystem:readonly=TRUE"]}]
				},
				{
					"name":        "DEPLOY:WAIT.1",
					"actions":     ["led:green=ON", "timeout:seconds=BLINK:1.0"],
					"transitions": [{"state": "DEPLOY:WAIT.2",  "conditions": ["peckus:payload=UNINITIALIZED", "timeout:expired=BLINK"]},
					                {"state": "DEPLOY:PAYLOAD", "conditions": ["filesystem:exists={payload_filename}"]}]
				},
				{
					"name":        "DEPLOY:WAIT.2",
					"actions":     ["led:green=OFF", "timeout:seconds=BLINK:1.0"],
					"transitions": [{"state": "DEPLOY:WAIT.1",  "conditions": ["peckus:payload=UNINITIALIZED", "timeout:expired=BLINK"]},
					                {"state": "DEPLOY:PAYLOAD", "conditions": ["filesystem:exists={payload_filename}"]}]
				},
				{
					"name":        "DEPLOY:PAYLOAD",
					"actions":     ["led:green=OFF", "peckus:install={payload_filename}"],
					"transitions": [{"state":"DEPLOY:READY", "conditions":["peckus:payload=INSTALLED"]}]
				},
				{
					"name":       "DEPLOY:READY",
					"actions":    ["system:reset=NOW"],
					"transitions": []
				}
			]
		},
		{
			"name":"UNLOCK",
			"initial-state":"UNLOCK:START",
			"states":
			[
				{
					"name":        "UNLOCK:START",
					"actions":     [],
					"transitions": [{"state": "UNLOCK:BUTTON", "conditions":["filesystem:mounted=TRUE", "filesystem:readonly=FALSE", "peckus:payload=INSTALLED"]}]
				},
				{
					"actions":     ["led:red=ON"],
					"name":        "UNLOCK:BUTTON",
					"transitions": [{"state": "UNLOCK:EXEC", "conditions":["system:reset=RESET_PIN"]}]
				},
				{
					"name":        "UNLOCK:EXEC",
					"actions":     ["peckus:unlock={payload_filename}", "led:red=OFF"],
					"transitions": []
				}
			]
		},
		{
			"name":"RELOCK",
			"initial-state":"RELOCK:START",
			"states":
			[
				{
					"name":        "RELOCK:START",
					"actions":     [],
					"transitions": [{"state": "RELOCK:TIMEOUT", "conditions":["peckus:payload=UNLOCKED"]}]
				},
				{
					"name":        "RELOCK:TIMEOUT",
					"actions":     ["timeout:seconds=RELOCK:{payload_timeout_secs}", "led:green=ON"],
					"transitions": [{"state": "RELOCK:EXEC", "conditions":["timeout:expired=RELOCK"]}]
				},
				{
					"name":        "RELOCK:EXEC",
					"actions":     ["led:green=OFF", "system:reset=NOW"],
					"transitions": []
				}
			]
		}
	]
}

